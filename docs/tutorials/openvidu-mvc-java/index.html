---
layout: docs-layout
title: OpenVidu Documentation - openvidu-mvc-java
active: documentation
---

<script src="/js/plugins/jquery.min.js"></script>

<link rel="stylesheet" href="/css/syntax.css" />
<script src="/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

<script type="text/javascript">
	$(document).ready(function () {
		$('li.subnav_drop').find('ul.subnav').hide();
		$(".subnav").find("li:contains('openvidu-mvc-java')").each(function (i, e) {
			var currentElement = $(e);
			currentElement.parent().css({
				"display": "block",
				"visibility": "visible"
			}); //css("background-color","blue");
			currentElement.css({
				"display": "block",
				"visibility": "visible"
			});
		});
		$('li.subnav_drop div').click(function (i, e) {
			//$('li.subnav_drop span').not(this).find('ul.subnav').hide();
			$(this).parent().find('ul.subnav').toggle();
		});

		var minHeight = $('#sticky-menu').outerHeight() + 100;
		$('#doc-container').css('min-height', minHeight + 'px');
	});

	$(".wy-nav-content").find("li:contains('openvidu-mvc-java')").css('color', 'red');
</script>

<div id="doc-container" class="container text-justify">
		<div id="sticky-menu" class="col-lg-3 col-md-4 col-sm-12 col-xs-12">

			
			<nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
				<div class="wy-menu wy-menu-vertical" role="navigation" aria-label="main navigation">
					<div id="site-menu-title">
						<h3>Explore docs</h3>
						<hr>
					</div>
					<ul id="menu-list" class="current">
						 
						<li>
							<ul> 

<li class="toctree-l1 ">
    <a class="" href="../../home/">What is OpenVidu?</a> 
</li>

</ul>
						</li>
						  
						<li>
							<ul> 

<li class="subnav_drop"><div><span>Tutorials</span></div>
    <ul class="subnav" hidden>
          

<li class="toctree-l1 ">
    <a class="" href="../">Intro</a> 
</li>

   

<li class="toctree-l1 ">
    <a class="" href="../openvidu-insecure-js/">openvidu-insecure-js</a> 
</li>

   

<li class="toctree-l1 ">
    <a class="" href="../openvidu-insecure-angular/">openvidu-insecure-angular</a> 
</li>

   

<li class="toctree-l1 ">
    <a class="" href="../openvidu-js-java/">openvidu-js-java</a> 
</li>

   

<li class="toctree-l1 current">
    <a class="current" href="./">openvidu-mvc-java</a>  
</li>

   

<li class="toctree-l1 ">
    <a class="" href="../openvidu-js-node/">openvidu-js-node</a> 
</li>

   

<li class="toctree-l1 ">
    <a class="" href="../openvidu-mvc-node/">openvidu-mvc-node</a> 
</li>

   

<li class="toctree-l1 ">
    <a class="" href="../openvidu-getaroom/">openvidu-getaroom</a> 
</li>

 
</li>
</ul>

</ul>
						</li>
						  
						<li>
							<ul> 

<li class="subnav_drop"><div><span>Reference documentation</span></div>
    <ul class="subnav" hidden>
          

<li class="toctree-l1 ">
    <a class="" href="../../reference-docs/openvidu-browser/">openvidu-browser API</a> 
</li>

   

<li class="toctree-l1 ">
    <a class="" href="../../reference-docs/openvidu-java-client/">openvidu-java-client API</a> 
</li>

   

<li class="toctree-l1 ">
    <a class="" href="../../reference-docs/openvidu-node-client/">openvidu-node-client API</a> 
</li>

   

<li class="toctree-l1 ">
    <a class="" href="../../reference-docs/REST-API/">REST  API</a> 
</li>

   

<li class="toctree-l1 ">
    <a class="" href="../../reference-docs/openvidu-artifacts/">OpenVidu Artifacts</a> 
</li>

 
</li>
</ul>

</ul>
						</li>
						  
						<li>
							<ul> 

<li class="subnav_drop"><div><span>Deployment</span></div>
    <ul class="subnav" hidden>
          

<li class="toctree-l1 ">
    <a class="" href="../../deployment/deploying-demos-aws/">Deploying OpenVidu Demos on AWS (TUTORIAL)</a> 
</li>

   

<li class="toctree-l1 ">
    <a class="" href="../../deployment/deploying-aws/">Deploying OpenVidu Server and your app on AWS</a> 
</li>

   

<li class="toctree-l1 ">
    <a class="" href="../../deployment/deploying-ubuntu/">Deploying OpenVidu as a native service</a> 
</li>

   

<li class="toctree-l1 ">
    <a class="" href="../../deployment/custom-certificate/">Using your own certificate</a> 
</li>

 
</li>
</ul>

</ul>
						</li>
						  
						<li>
							<ul> 

<li class="subnav_drop"><div><span>Contribute</span></div>
    <ul class="subnav" hidden>
          

<li class="toctree-l1 ">
    <a class="" href="../../developing/">Developing OpenVidu</a> 
</li>

 
</li>
</ul>

</ul>
						</li>
						 
					</ul>
				</div>
				&nbsp;
			</nav>
		</div>

		<section class="col-lg-9 col-md-8 col-sm-12 col-xs-12">
			
			<div>
				<div>

					<div role="main">
						<div class="section">
							 <h1 id="openvidu-mvc-java">openvidu-mvc-java</h1>
<p>A secure OpenVidu sample app with a Java backend and a traditional MVC frontend. With regard to the use of OpenVidu, it is identical to <a href="https://github.com/OpenVidu/openvidu-tutorials/tree/master/openvidu-js-java">openvidu-js-java</a>. This tutorial is intended for developers who feel more comfortable with MVC web architectures for their frontends. <a href="http://www.thymeleaf.org/">Thymeleaf</a> is the template engine of choice for this tutorial.</p>
<h2 id="understanding-this-example">Understanding this example</h2>
<p align="center">
  <img class="img-responsive" src="https://docs.google.com/uc?id=0B61cQ4sbhmWSQzJGRDhzS1dNZFk">
</p>

<p>OpenVidu is composed by the modules displayed on the image above.</p>
<ul>
<li><strong>openvidu-browser</strong>: JavaScript library for the browser. It allows you to manage your video-calls straight away from your clients</li>
<li><strong>openvidu-java-client</strong>: Java package to easily get the necessary params (sessionId's and tokens) from openvidu-server. Quick alternative to REST API</li>
<li><strong>openvidu-server</strong>: Java application that controls Kurento Media Server</li>
<li><strong>Kurento Media Server</strong>: server that handles low level operations of media flow transmissions</li>
</ul>
<blockquote>
<p>You will only have to make use of <strong>openvidu-browser</strong> and <strong>openvidu-java-client</strong> to get this sample app working</p>
</blockquote>
<h2 id="executing-this-example">Executing this example</h2>
<p>1) Clone the repo:</p>
<pre><code class="bash">git clone https://github.com/OpenVidu/openvidu-tutorials.git
</code></pre>

<p>2) You will need <em>maven</em> to build the project. You can install it with:</p>
<pre><code class="bash">sudo apt-get install maven
</code></pre>

<p>3) To run the sample application, execute the following command in the project:</p>
<pre><code class="bash">cd openvidu-mvc-java
mvn package exec:java
</code></pre>

<p>4) <em>openvidu-server</em> and <em>Kurento Media Server</em> must be up and running in your development machine. The easiest way is running this Docker container which wraps both of them (you will need <a href="https://store.docker.com/search?type=edition&amp;offering=community">Docker CE</a>):</p>
<pre><code class="bash">docker run -p 8443:8443 --rm -e KMS_STUN_IP=stun.l.google.com -e KMS_STUN_PORT=19302 -e openvidu.secret=MY_SECRET openvidu/openvidu-server-kms
</code></pre>

<p>5) Go to <a href="https://localhost:5000"><code>https://localhost:5000</code></a> to test the app once the server is running. The first time you use the docker container, an alert message will suggest you accept the self-signed certificate of <em>openvidu-server</em> when you first try to join a video-call. To test two users in the same computer, use a standard window and an incognito window.</p>
<div class="row no-margin row-gallery">
    <div class="col-md-6">
        <a data-fancybox="gallery2" href="/img/demos/secure-login.png">
            <img class="img-responsive" src="/img/demos/secure-login.png">
        </a>
    </div>
    <div class="col-md-6">
        <a data-fancybox="gallery2" href="/img/demos/secure-join.png">
            <img class="img-responsive" src="/img/demos/secure-join.png">
        </a>
    </div>
</div>

<div class="row no-margin row-gallery">
    <div class="col-md-6">
        <a data-fancybox="gallery2" href="/img/demos/secure-session-2.png">
            <img class="img-responsive" src="/img/demos/secure-session-2.png">
        </a>
    </div>
    <div class="col-md-6">
        <a data-fancybox="gallery2" href="/img/demos/secure-session-1.png">
            <img class="img-responsive" src="/img/demos/secure-session-1.png">
        </a>
    </div>
</div>

<h2 id="understanding-the-code">Understanding the code</h2>
<p>This is a very basic web application with a pretty simple JS/HTML/CSS frontend and a straightforward Java backend that serves HTML files with a MVC approach, building the templates with the help of <a href="http://www.thymeleaf.org/">Thymeleaf</a>.</p>
<p>OpenVidu assumes you can identify your users so you can tell which users can connect to which video-calls, and what role (and therefore what permissions) each one of them will have in the calls. You can do this as you prefer. Here our backend will manage the users and their sessions with the easy-to-use and non-intrusive <em>HttpSession</em> API. In these posts multiple options for user session management in Java are explained, inlcuding the one used in this tutorial: <a href="http://www.journaldev.com/1907/java-session-management-servlet-httpsession-url-rewriting">journaldev.com</a>, <a href="http://www.studytonight.com/servlet/session-management.php">studytonight.com</a>.</p>
<ul>
<li>
<p><strong>Backend</strong>: SpringBoot app with the following classes (<code>src/main/java</code> path, <code>io.openvidu.js.java</code> package)</p>
<ul>
<li><code>App.java</code> : entrypoint for the app</li>
<li><code>LoginController.java</code> : controller for handling login and logout operations</li>
<li><code>SessionController.java</code> : controller for getting sessionId's and tokens. It also stores our active video-calls and the users connected to them</li>
</ul>
</li>
<li>
<p><strong>Frontend templates</strong>: Pure JS/HTML/CSS files served by the backend (<code>src/main/resources/templates</code>)</p>
<ul>
<li><code>index.html</code> : template with the login form</li>
<li><code>dashboard.html</code> : template with the form to join a video-call</li>
<li><code>session.html</code> : template of the video-call itself</li>
</ul>
</li>
<li>
<p><strong>Frontend static files</strong> (<code>src/main/resources/static</code>)</p>
<ul>
<li><code>openvidu-browser-VERSION.js</code> : openvidu-browser library. You don't have to manipulate this file</li>
<li><code>style.css</code> : some CSS classes to style the templates</li>
</ul>
</li>
</ul>
<p>Let's describe the code following this scenario: a user logs in to the app and connects to the video-call "TUTORIAL", where he publishes his webcam. A second user will connect to the same video-call just after that and publish its own webcam. Both of them will leave the call after a while.</p>
<hr />
<h3 id="1-user-logs-in">1) User logs in</h3>
<p>At path <code>/</code> a login form will be displayed:</p>
<p align="center">
  <img class="img-responsive" style="max-width: 300px; padding: 25px 0;" src="https://docs.google.com/uc?id=0B61cQ4sbhmWSV3phM2JTWHBxakk">
</p>

<p>The form will execute a POST operation to path <code>/dashboard</code> whenever "Log in" button is clicked, passing the username and the password:</p>
<pre><code class="html">&lt;form class=&quot;form-group jumbotron&quot; action=&quot;/dashboard&quot; method=&quot;post&quot;&gt;
    &lt;p&gt;
        &lt;label&gt;User&lt;/label&gt;
        &lt;input class=&quot;form-control&quot; type=&quot;text&quot; name=&quot;user&quot; required=&quot;true&quot;&gt;&lt;/input&gt;
    &lt;/p&gt;
    &lt;p&gt;
        &lt;label&gt;Pass&lt;/label&gt;
        &lt;input class=&quot;form-control&quot; type=&quot;password&quot; name=&quot;pass&quot; required=&quot;true&quot;&gt;&lt;/input&gt;
    &lt;/p&gt;
    &lt;p class=&quot;text-center&quot;&gt;
        &lt;button class=&quot;btn btn-lg btn-info&quot; type=&quot;submit&quot;&gt;Log in&lt;/button&gt;
    &lt;/p&gt;
&lt;/form&gt;
</code></pre>

<p><code>LoginController.java</code> first checks if the user is already logged (maybe he has just refreshed <code>/dashboard</code> page), and if so it just redirects to the dashboard itself. If the user is actually logging in, the method checks that the params are correct and if so sets an <em>HttpSession</em> for the newly logged user (adding a "loggedUser" attribute with its username in the HttpSession object). Finally it returns <code>dashboard.html</code> template:</p>
<pre><code class="java">@RequestMapping(value = &quot;/dashboard&quot;, method = { RequestMethod.GET, RequestMethod.POST })
public String login(@RequestParam(name = &quot;user&quot;, required = false) String user,
            @RequestParam(name = &quot;pass&quot;, required = false) String pass,
            Model model, HttpSession httpSession) {

    // Check if the user is already logged in
    String userName = (String) httpSession.getAttribute(&quot;loggedUser&quot;);
    if (userName != null) { 
        // User is already logged. Immediately return dashboard
        model.addAttribute(&quot;username&quot;, userName);
        return &quot;dashboard&quot;;
    }

    // User wasn't logged and wants to
    if (login(user, pass)) { // Correct user-pass

        // Validate session and return OK 
        // Value stored in HttpSession allows us to identify the user in future requests
        httpSession.setAttribute(&quot;loggedUser&quot;, user);
        model.addAttribute(&quot;username&quot;, user);

        // Return dashboard.html template
        return &quot;dashboard&quot;;

    } else { // Wrong user-pass
        // Invalidate session and redirect to index.html
        httpSession.invalidate();
        return &quot;redirect:/&quot;;
    }
}
</code></pre>

<hr />
<h3 id="2-user-connects-to-tutorial-video-call">2) User connects to "TUTORIAL" video-call</h3>
<p><code>dashboard.html</code> template will display a form asking for the video-call to connect and the nickname the user wants to have in it. So our 'publisher1' user would write TUTORIAL in "Session" field:</p>
<p align="center">
  <img class="img-responsive" style="max-width: 500px; padding: 25px 0;" src="https://docs.google.com/uc?id=0B61cQ4sbhmWSMElwU2l1cGpKQzQ">
</p>

<p>The form will execute a POST operation to path <code>/session</code> whenever "Join!" button is clicked, passing the nickname and the session name:</p>
<pre><code class="html">&lt;form class=&quot;form-group&quot; action=&quot;/session&quot; method=&quot;post&quot;&gt;
    &lt;p&gt;
        &lt;label&gt;Participant&lt;/label&gt;
        &lt;input class=&quot;form-control&quot; type=&quot;text&quot; name=&quot;data&quot; required=&quot;true&quot;&gt;&lt;/input&gt;
    &lt;/p&gt;
    &lt;p&gt;
        &lt;label&gt;Session&lt;/label&gt;
        &lt;input class=&quot;form-control&quot; type=&quot;text&quot; name=&quot;session-name&quot; required=&quot;true&quot;&gt;&lt;/input&gt;
    &lt;/p&gt;
    &lt;p class=&quot;text-center&quot;&gt;
        &lt;button class=&quot;btn btn-lg btn-success&quot; type=&quot;submit&quot;&gt;Join!&lt;/button&gt;
    &lt;/p&gt;
&lt;/form&gt;
</code></pre>

<p>When <code>SessionController.java</code> receives a request at <code>/session</code> path is when things get interesting.
First of all there are some important attributes in this class we must mention:</p>
<pre><code class="java">// OpenVidu object to ask openvidu-server for sessionId and token
private OpenVidu openVidu;

// Collection to pair session names and OpenVidu Session objects
private Map&lt;String, Session&gt; mapSessions = new ConcurrentHashMap&lt;&gt;();
// Collection to pair sessionId's and tokens (the inner Map pairs tokens and role associated)
private Map&lt;String, Map&lt;String, OpenViduRole&gt;&gt; mapSessionIdsTokens = new ConcurrentHashMap&lt;&gt;();

// URL where our OpenVidu server is listening
private String OPENVIDU_URL;
// Secret shared with our OpenVidu server
private String SECRET;
</code></pre>

<p>Rest controller method receives both params sent by the client (whatever nickname the user has chosen and "TUTORIAL" as the sessionName). First it prepares a param we will need a little further on: <code>tokenOptions</code>.</p>
<pre><code class="java">@RequestMapping(value = &quot;/session&quot;, method = RequestMethod.POST)
public String joinSession(@RequestParam(name = &quot;data&quot;) String clientData,
              @RequestParam(name = &quot;session-name&quot;) String sessionName, 
              Model model, HttpSession httpSession) {
    // Check the user is logged ... 

    // Role associated to this user
    OpenViduRole role = LoginController.users.get(httpSession.getAttribute(&quot;loggedUser&quot;)).role;

    // Optional data to be passed to other users when this user connects to the video-call
    // In this case, a JSON with the value we stored in the HttpSession object on login
    String serverData = &quot;{\&quot;serverData\&quot;: \&quot;&quot; + httpSession.getAttribute(&quot;loggedUser&quot;) + &quot;\&quot;}&quot;;

    // Build tokenOptions object with the serverData and the role
    TokenOptions tokenOptions = new TokenOptions.Builder().data(serverData).role(role).build();
</code></pre>

<p>Just after that an <em>if-else</em> statement comes into play: does the session "TUTORIAL" already exist? </p>
<pre><code class="java">if (this.mapSessions.get(sessionName) != null) { ...
</code></pre>

<p>In this case it doesn't because 'publisher1' is the first user connecting to it. So we focus on the <em>else</em> branch:</p>
<pre><code class="java">else {
    // New session: return a new sessionId and a new token
    try {

        // Create a new OpenVidu Session
        Session session = this.openVidu.createSession();
        // Get the sessionId
        String sessionId = session.getSessionId();
        // Generate a new token with the recently created tokenOptions
        String token = session.generateToken(tokenOptions);

        // Store the session and the token in our collections
        this.mapSessions.put(sessionName, session);
        this.mapSessionIdsTokens.put(sessionId, new ConcurrentHashMap&lt;&gt;());
        this.mapSessionIdsTokens.get(sessionId).put(token, role);

        // Add all the needed attributes to the template
        model.addAttribute(&quot;sessionId&quot;, sessionId);
        model.addAttribute(&quot;token&quot;, token);
        model.addAttribute(&quot;nickName&quot;, clientData);
        model.addAttribute(&quot;userName&quot;, httpSession.getAttribute(&quot;loggedUser&quot;));
        model.addAttribute(&quot;sessionName&quot;, sessionName);

        // Return session.html template
        return &quot;session&quot;;

    } catch (Exception e) {
        // If error just return dashboard.html template
        model.addAttribute(&quot;username&quot;, httpSession.getAttribute(&quot;loggedUser&quot;));
        return &quot;dashboard&quot;;
    }
}
</code></pre>

<p>We are almost there! Now in <code>session.html</code> JavaScript code (preceded by a tag <code>&lt;script th:inline="javascript"&gt;</code>) we can init a new Session with <em>sessionId</em> and connect to it with <em>token</em>:</p>
<pre><code class="javascript">// Get all the attributes from the template in Thymeleaf style
var sessionId = [[${sessionId}]];
var token = [[${token}]];
var nickName = [[${nickName}]];
var userName = [[${userName}]];
var sessionName = [[${sessionName}]];

// --- 1) Get an OpenVidu object and init a session with the retrieved sessionId ---

var OV = new OpenVidu();
var session = OV.initSession(sessionId);


// --- 2) Specify the actions when events take place ---

// On every new Stream received...
session.on('streamCreated', function (event) {

    // Subscribe to the Stream to receive it
    // HTML video will be appended to element with 'video-container' id
    var subscriber = session.subscribe(event.stream, 'video-container');

    // When the HTML video has been appended to DOM...
    subscriber.on('videoElementCreated', function (event) {

        // Add a new HTML element for the user's name and nickname over its video
        appendUserData(event.element, subscriber.stream.connection);
    });
});

// On every Stream destroyed...
session.on('streamDestroyed', function (event) {
    // Delete the HTML element with the user's name and nickname
    removeUserData(event.stream.connection);
});


// --- 3) Connect to the session passing the retrieved token and some more data from
//         the client (in this case a JSON with the nickname chosen by the user) ---
session.connect(token, '{&quot;clientData&quot;: &quot;' + nickName + '&quot;}', function (error) {

    // If the connection is successful, initialize a publisher and publish to the session
    if (!error) {

        // Here we check somehow if the user has at least 'PUBLISHER' role before
        // trying to publish its stream. Even if someone modified the client's code and
        // published the stream, it wouldn't work if the token sent in Session.connect
        // method doesn't belong to a 'PUBLIHSER' role
        if (isPublisher()) {

            // --- 4) Get your own camera stream ---

            var publisher = OV.initPublisher('video-container', {
                audio: true,
                video: true,
                quality: 'MEDIUM'
            });

            // When our HTML video has been added to DOM...
            publisher.on('videoElementCreated', function (event) {
                // Init the main video with ours and append our data
                var userData = {
                    nickName: nickName,
                    userName: userName
                };
                initMainVideo(event.element, userData);
                appendUserData(event.element, userData);
                $(event.element).prop('muted', true);  // Mute local video
            });


            // --- 5) Publish your stream ---

            session.publish(publisher);

        } else {
            console.warn('You don\'t have permissions to publish');
            initMainVideoThumbnail(); // Show SUBSCRIBER message in main video
        }
    } else {
        console.warn('There was an error connecting to the session:', error.code, error.message);
    }
});
</code></pre>

<p>The user will now see its own video on the page. The connection to the session has completed!</p>
<hr />
<h3 id="3-another-user-connects-to-the-video-call">3) Another user connects to the video-call</h3>
<p>The process would be exactly the same as before until <code>SessionController.java</code> executes <code>getSessionIdAndToken()</code> method. Now session 'TUTORIAL' already exists, so in the <em>if-else</em> statement the <em>if</em> branch would be the one executed:</p>
<pre><code class="java">if (this.mapSessions.get(sessionName) != null) {
    // Session already exists: return existing sessionId and a new token
    try {

        // Get the existing sessionId from our collection with 
        // the sessionName param (&quot;TUTORIAL&quot;)
        String sessionId = this.mapSessions.get(sessionName).getSessionId();
        // Generate a new token with the recently created tokenOptions
        String token = this.mapSessions.get(sessionName).generateToken(tokenOptions);

        // Update our collection storing the new token
        this.mapSessionIdsTokens.get(sessionId).put(token, role);

        // Add all the needed attributes to the template
        model.addAttribute(&quot;sessionId&quot;, sessionId);
        model.addAttribute(&quot;token&quot;, token);
        model.addAttribute(&quot;nickName&quot;, clientData);
        model.addAttribute(&quot;userName&quot;, httpSession.getAttribute(&quot;loggedUser&quot;));
        model.addAttribute(&quot;sessionName&quot;, sessionName);

        // Return session.html template
        return &quot;session&quot;;

    } catch (Exception e) {
        // If error just return dashboard.html template
        model.addAttribute(&quot;username&quot;, httpSession.getAttribute(&quot;loggedUser&quot;));
        return &quot;dashboard&quot;;
    }
}
</code></pre>

<p>The code executed in <code>session.html</code> <em>&lt; script &gt;</em> tag would also be the same. After the <code>Session.publish()</code> method has been succesful, both users will be seeing each other's video, as well as the username and the nickname below it.</p>
<hr />
<h3 id="4-users-leave-the-video-call">4) Users leave the video-call</h3>
<p>After a while both users decide to leave the session. Apart from calling <code>session.disconnect()</code> (triggered in <code>leaveSession()</code> <em>onclick</em> method) to destroy the connection on openvidu-server, we need another POST operation to let the backend know that certain user has left the session so it can update the collections with the active sessions and tokens.</p>
<p>In <code>session.html</code> template the "Leave session" button actually performs a POST operation to path <code>/leave-session</code> with a hidden form. Notice that when the user clicks the submit button, a POST operation will be triggered but also the <code>leaveSession()</code> method. First updates our backend. Second updates our openvidu-server.</p>
<pre><code class="html">&lt;form action=&quot;/leave-session&quot; method=&quot;post&quot;&gt;
    &lt;input type=&quot;hidden&quot; name=&quot;session-name&quot; th:value=&quot;${sessionName}&quot;&gt;&lt;/input&gt;
    &lt;input type=&quot;hidden&quot; name=&quot;token&quot; th:value=&quot;${token}&quot;&gt;&lt;/input&gt;
    &lt;button id=&quot;buttonLeaveSession&quot; class=&quot;btn btn-large btn-danger&quot; type=&quot;submit&quot; onclick=&quot;leaveSession()&quot;&gt;
        Leave session&lt;/button&gt;
&lt;/form&gt;
</code></pre>

<p>In <code>SessionController.java</code> we update the collections:</p>
<pre><code class="java">@RequestMapping(value = &quot;/leave-session&quot;, method = RequestMethod.POST)
public String removeUser(@RequestParam(name = &quot;session-name&quot;) String sessionName,
             @RequestParam(name = &quot;token&quot;) String token,
             Model model, HttpSession httpSession) throws Exception {
    // Check the user is logged ... 

    // If the session exists (&quot;TUTORIAL&quot; in this case)
    if (this.mapSessions.get(sessionName) != null) {
        String sessionId = this.mapSessions.get(sessionName).getSessionId();

        if (this.mapSessionIdsTokens.containsKey(sessionId)) {
            // If the token exists
            if (this.mapSessionIdsTokens.get(sessionId).remove(token) != null) {
                // User left the session
                if (this.mapSessionIdsTokens.get(sessionId).isEmpty()) {
                    // Last user left: session &quot;TUTORIAL&quot; must be removed
                    this.mapSessions.remove(sessionName);
                }
                return &quot;redirect:/dashboard&quot;;
            } else {
                // The TOKEN wasn't valid
                return &quot;redirect:/dashboard&quot;;
            }
        } else {
            // The SESSIONID wasn't valid
            return &quot;redirect:/dashboard&quot;;
        }
    } else {
        // The SESSION does not exist
        return &quot;redirect:/dashboard&quot;;
    }
}
</code></pre>

<p>When the last user leaves the session <code>this.mapSessions.remove(sessionName);</code> will be executed: this means the session is empty and that it is going to be closed. The <em>sessionId</em> and all <em>token</em> params associated to it will be invalidated.</p>
<hr />
<blockquote>
<p>At this point we have covered all the important code from the tutorial. With this scenario we have seen the most common use-case, but you can modify whatever you want to suit your needs. And remember that this is just one of the many possible approaches: <strong>you can implement your frontend and your backend as you want</strong>. </p>
<p>The only actual requirements are getting <strong><em>sessionId</em></strong> and <strong><em>token</em></strong> params from  <strong><em>openvidu-server</em></strong> (by using one of the available clients or with the REST API) and using them along with <strong><em>openvidu-browser</em></strong> to connect your clients to the sessions.</p>
</blockquote> 
						</div>
					</div> <footer>
<hr>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../openvidu-js-node/" class="btn btn-xs btn-primary float-right" title="openvidu-js-node">Next &raquo;<span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../openvidu-js-java/" class="btn btn-xs btn-primary" title="openvidu-js-java"><span class="icon icon-circle-arrow-left"></span> &laquo; Prev</a>
      
    </div>
  


  
  <div id="edit-github">
  
	  <a href="https://github.com/OpenVidu/openvidu.io-docs/blob/master/docs/tutorials/openvidu-mvc-java.md"><i class="icon ion-social-github"></i> Edit Documentation on GitHub</a>
  
  </div>
</footer> 
				</div>
			</div>
		</section>
</div>